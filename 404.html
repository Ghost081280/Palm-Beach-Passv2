<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palm Beach Pass - Redirecting...</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #FAF3E3, #FFFFFF);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }
        .logo { font-size: 4rem; margin-bottom: 1rem; }
        .title { font-size: 1.5rem; color: #2D5016; margin-bottom: 1rem; }
        .message { color: #666; margin-bottom: 2rem; }
        .spinner {
            width: 40px; height: 40px;
            border: 4px solid rgba(45,80,22,0.1);
            border-top: 4px solid #2D5016;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 2rem;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .btn { 
            background: #2D5016; color: white; padding: 1rem 2rem; 
            border: none; border-radius: 25px; cursor: pointer; 
            margin: 0.5rem; font-size: 1rem; text-decoration: none;
            display: inline-block;
        }
        .debug { 
            background: rgba(0,0,0,0.8); color: white; padding: 1rem; 
            border-radius: 10px; font-size: 0.8rem; max-width: 90%; 
            margin-top: 2rem; text-align: left; white-space: pre-wrap;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="logo">üå¥</div>
    <h1 class="title">Palm Beach Pass</h1>
    <p class="message">Detecting your device...</p>
    <div class="spinner" id="spinner"></div>
    
    <div style="margin-top: 2rem;">
        <a href="index.html" class="btn">üñ•Ô∏è Desktop Version</a>
        <a href="mobile-purchase.html" class="btn">üì± Mobile Version</a>
    </div>
    
    <div class="debug" id="debug"></div>

    <script>
        // Enhanced mobile detection
        function isMobileDevice() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            
            // Check for mobile user agents
            const mobileRegex = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini|mobile|tablet/i;
            const isMobileUA = mobileRegex.test(userAgent.toLowerCase());
            
            // Check screen size
            const isSmallScreen = window.innerWidth <= 768;
            
            // Check touch capability
            const hasTouch = ('ontouchstart' in window) || 
                           (navigator.maxTouchPoints > 0) || 
                           (navigator.msMaxTouchPoints > 0);
            
            // Check orientation (mobile devices have this)
            const hasOrientation = typeof window.orientation !== 'undefined';
            
            // Final decision
            return isMobileUA || (isSmallScreen && (hasTouch || hasOrientation));
        }
        
        // Get detailed debug info
        const debugInfo = `404 Page Debug Info:
============================
URL: ${window.location.href}
User Agent: ${navigator.userAgent}
Screen: ${window.innerWidth}x${window.innerHeight}
Is Mobile UA: ${/mobile|android|iphone/i.test(navigator.userAgent)}
Is Small Screen: ${window.innerWidth <= 768}
Has Touch: ${('ontouchstart' in window) || (navigator.maxTouchPoints > 0)}
Touch Points: ${navigator.maxTouchPoints}
Platform: ${navigator.platform}
Vendor: ${navigator.vendor}
Mobile Detection Result: ${isMobileDevice()}
============================`;
        
        document.getElementById('debug').textContent = debugInfo;
        console.log(debugInfo);
        
        // Determine redirect
        let redirectTo = 'index.html'; // Default to desktop
        
        if (isMobileDevice()) {
            console.log('Mobile device detected on 404 page');
            
            // Check if user has account
            let hasAccount = false;
            try {
                hasAccount = localStorage.getItem('isLoggedIn') === 'true' || 
                            localStorage.getItem('userPasses') !== null;
            } catch(e) {
                console.error('LocalStorage error:', e);
            }
            
            if (hasAccount) {
                redirectTo = 'mobile.html';
                console.log('User has account -> mobile app');
            } else {
                redirectTo = 'mobile-purchase.html';
                console.log('New user -> mobile purchase');
            }
        } else {
            console.log('Desktop device detected on 404 page');
        }
        
        // Update message
        document.querySelector('.message').textContent = `Redirecting to ${redirectTo}...`;
        
        // Redirect after 2 seconds
        setTimeout(() => {
            console.log('Redirecting from 404 to:', redirectTo);
            window.location.href = redirectTo;
        }, 2000);
    </script>
</body>
</html>
